<!doctype html>
<html>

<head>
  <meta name="viewport" content="width=device-width, height=device-height,
  user-scalable=no, initial-scale=1, maximum-scale=1">
  <title>sounds some sounds</title>
  <link rel="stylesheet" href="index.css" type="text/css" />
</head>

<body>
  <script src="./libs/sss/index.js"></script>
  <script src="./libs/p5/p5.min.js"></script>
  <script>
function setup() {
  sss.init(9677173); // initialize sss (9677173 is a random seed)
  createCanvas(480, 480);
  noStroke();
  initSeedUi();
}
var isInGame = false;
var score = 0;
var ticks = 0;
var shipX = 240;
var shipY = 320;
var shipSize = 36;
var items = [];
function touchStarted() {
  sss.playEmpty(); // play an empty sound in a touch event handler for iOS
  if (!isInGame) {
    sss.playBgm(); // start playing a BGM
    isInGame = true;
    score = 0;
    ticks = 0;
  }
}
function touchMoved() {
  return false;
}
function draw() {
  sss.update(); // update function should be called in an animation frame handler
  background(255);
  if (isInGame) {
    fill('#8e8');
    shipX = constrain(mouseX, 16, 480 - 16);
    rect(shipX - shipSize / 2, shipY - shipSize / 2, shipSize, shipSize);
  }
  if (random() < 0.1 * Math.sqrt(ticks / 1000 + 1)) {
    var pos = createVector(random() * 480, -60);
    var size = (random() * random() + 0.5) * 100;
    var speed = (random() + 1) * (Math.sqrt(ticks / 1000 + 1)) * 2;
    var isEnemy = random() < (0.2 * Math.sqrt(ticks / 1000 + 1));
    items.push({ pos: pos, size: size, speed: speed, isEnemy: isEnemy });
  }
  for (var i = 0; i < items.length;) {
    var it = items[i];
    it.pos.y += it.speed;
    fill(it.isEnemy ? '#e88' : '#ee8');
    rect(it.pos.x - it.size / 2, it.pos.y - it.size / 2, it.size, it.size);
    var isHitting = isInGame &&
      (Math.abs(it.pos.x - shipX) < (it.size + shipSize) / 2 &&
        Math.abs(it.pos.y - shipY) < (it.size + shipSize) / 2);
    if (it.pos.y > 550 || isHitting) {
      if (isHitting) {
        if (it.isEnemy) {
          sss.play('u1', 7); // play the jsfx.Preset.L'u'cky SE (7 sounds at a time)
          isInGame = false;
          sss.stopBgm();
        } else {
          sss.play('c1'); // play the jsfx.Preset.'C'oin SE
          score++;
        }
      }
      items.splice(i, 1);
    } else {
      i++;
    }
  }
  fill('#135');
  textSize(24);
  text(score, 20, 40);
  ticks++;
}
function initSeedUi() {
  var change = document.getElementById('change');
  var seed = document.getElementById('seed');
  var set = document.getElementById('set');
  change.onclick = function() {
    seed.value = Math.floor(Math.random() * 9999999).toString();
    reset();
  };
  set.onclick = reset;
  function reset() {
    sss.reset();
    sss.setSeed(Number(seed.value));
    if (isInGame) {
      sss.playBgm();
    }
  }
}
  </script>
  <!--
  <script src="../app/index.js"></script>
  <script src="http://localhost:35729/livereload.js"></script>
  -->
  <p>[Mouse/Touch]: move</p>
  <p>
    <button id="change">change</button>
    random seed: <input type="number" id="seed" value="0"></input>
    <button id="set">set</button>
  </p>
</body>

</html>